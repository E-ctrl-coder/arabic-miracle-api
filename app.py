from flask import Flask, request, jsonify
from flask_cors import CORS
import openai
import os

app = Flask(__name__)
CORS(app)

# Set OpenAI API key
openai.api_key = os.getenv("OPENAI_API_KEY")

@app.route("/analyze", methods=["POST"])
def analyze():
    data = request.get_json()
    word = data.get("word", "").strip()

    if not word:
        return jsonify({"error": "No word provided."}), 400

    try:
        prompt = f"""
ุฃูุช ุฎุจูุฑ ูู ุงููุบููุงุช ุงูุนุฑุจูุฉ ูุงูุตุฑู ุงููุฑุขูู.

ุญูู ุงููููุฉ ุงูุนุฑุจูุฉ: "{word}"

ูุฌุจ ุฃู ุชูุฑุฌุน ุงููุชูุฌุฉ ุจุตูุบุฉ HTML ุจุงุณุชุฎุฏุงู:
- <span class='root'> ููุญุฑูู ุงูุฌุฐุฑูุฉ
- <span class='prefix'> ููุญุฑูู ุงูุฒุงุฆุฏุฉ ูุจุงุฏุฆุฉ
- <span class='suffix'> ููุญุฑูู ุงูุฒุงุฆุฏุฉ ููุงุญูุฉ
- <span class='extra'> ูุฃู ุญุฑูู ุฒุงุฆุฏุฉ ุฃุฎุฑู

๐น ูุฌุจ ุฃู ุชุชุถูู ุงููุชูุฌุฉ:

1. **ุงููููุฉ ูุน ุงูุชูููู**:
   - ุญุฏุฏ ุงูุฌุฐุฑ ุฏุงุฎู ุงููููุฉ ุจุงุณุชุฎุฏุงู <span class='root'>
   - ุงูุญุฑูู ุงูุฒุงุฆุฏุฉ ุจู <span class='prefix'> ุฃู <span class='suffix'> ุฃู <span class='extra'>

2. **ุฌุฐุฑ ุงููููุฉ (ุจุงูุนุฑุจูุฉ)**:
   - ุงูุชุจ ุงูุฌุฐุฑ ุจุงูุญุฑูู ุงูููุฑุฏุฉ ุฏุงุฎู <span class='root'>
   - ุชุฑุฌู ุงูุฌุฐุฑ ููุฅูุฌููุฒูุฉ (ูุซูุงู: ู-ุช-ุจ โ to write)

3. **ูุนูู ุงููููุฉ ุงููุงููุฉ ุจุงูุฅูุฌููุฒูุฉ**

4. **ุงูุงุณุชุนูุงู ุงููุฑุขูู**:
   - ุงุณุชุฎุฏู **ุงูุฌุฐุฑ ุงูุนุฑุจู ููุท** (ูููุณ ุงูุชุฑุฌูุฉ) ููุจุญุซ
   - ุนุฏุฏ ูุฑุงุช ุธููุฑ ุงูุฌุฐุฑ ูู ุงููุฑุขู ุงููุฑูู
   - ุฃุนุฑุถ ุขูุชูู ุฃู ุซูุงุซ ุชุญุชูู ุนูู ุงูุฌุฐุฑ
   - ุธูู ุงูุญุฑูู ุงูุฌุฐุฑูุฉ ูู ุงูุขูุฉ ุจุงุณุชุฎุฏุงู <span class='root'>

5. **ุงููุฒู ุงูุตุฑูู (ุงูููุฒุงู)**:
   - ุงุฐูุฑ ุงููุฒู ุงูุตุฑูู ูููููุฉ (ูุซู: ููุนููุงูุ ููููุชูุนูู)
   - ูุง ููุน ูุฐุง ุงููุฒูุ (ูุซู: ุตูุบุฉ ูุจุงูุบุฉุ ุงุณู ููุงูุ ูุนู ูุฌุฑุฏ...)

โ ูุฌุจ ุฃู ุชููู ูู ุงูุฅุฌุงุจุงุช ุจุงูุนุฑุจูุฉุ ูุน ุงูุชุฑุฌูุฉ ุงูุฅูุฌููุฒูุฉ ุญูุซ ููุทูุจ ููุท. ูุง ุชุณุชุฎุฏู ุงูุชุฑุฌูุฉ ุงูุฅูุฌููุฒูุฉ ููุจุญุซ ุนู ุงูุฌุฐุฑ ูู ุงููุฑุขู. ูุธูู ุงูุชูุณูู ุจูุถูุญ ุจุงุณุชุฎุฏุงู HTML.
"""

        response = openai.ChatCompletion.create(
            model="gpt-4",
            messages=[{"role": "user", "content": prompt}],
            temperature=0.7
        )

        reply = response.choices[0].message.content
        return jsonify({"result": reply})

    except Exception as e:
        return jsonify({"error": str(e)}), 500

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=10000)
